

The following sections describe how to use **_qpipeline_** to annotate a VCF file with a BED database file.

## Create and index a BED database file 

The instructions provided here can be used to create any BED database files.  For simplicity, a simple BED file called _target.bed_ is provided in _${QPIPELINE_HOME}/test_data/vcf_.  

Change directory to _${QPIPELINE_HOME}/test_data/vcf_.  To create a BED database file for _target.bed_, do the following
```
# set the FILE variable so we can cut, paste, and reuse all the commands below
# for any BED database file set to FILE
FILE="target.bed"

# sort the file by chromosomes, start, and end
cat $FILE  | sort -k1,1 -k2,2n -k3,3n > ${FILE}.sorted

# Zip the sorted file using bgzip ( bgzip is part of tabix )
bgzip ${FILE}.sorted


# index the zipped file using tabix
# an index file with extension .tbi is generated by tabix
# once done, ${FILE}.sorted.gz  can be used as the BED database for qpipeline
tabix -p bed ${FILE}.sorted.gz 
```



## Annotate an input VCF file against a BED database file

Annotate _sample.vcf_ with the _target.bed.sorted.gz_ database and direct output to _sample.target.vcf_
```
qpipeline tabix -m 2000 -i sample.vcf  -d target.bed.sorted.gz -q MY_TARGET > sample.target.vcf 
```
where ( run _qpipeline tabix -m 2000_ for full usage info )
* -i input VCF file 
* -d bgziped and tabix indexed BED database file 
* -q BED database identifer.  For example, MY_TARGET.

In the annotation command above, the input VCF file is _sample.vcf_, the bgzipped and tabix indexed BED database is _target.bed.sorted.gz_, the BED database identifier is _MY_TARGET_ and the rediected output file is _sample.target.vcf_.

If a position ( chromosome and position ) of an entry in the input file falls within any of the ranges in the BED file, then the annotation added to the VCF INFO column looks like as follows:

```
...;IDENTIFER=n,M,.,DATA;...
```
where 

* IDENTIFIER is the BED database identifer entered by the user and n is either 0 (no matches from the BED database ) or 1 ( there is at least one match from the BED database)
* M is the number of targets matches from the BED database. 
* DATA is string contained one or more target entries from the BED database.


Once annotated, entries on target can be easily extracted by doing the following:
```
cat sample.target.vcf | grep MY_TARGET=1 | less
```
The command above produced 2 entries:
```
chr1	10616	rs376342519	CCGCCGTTGCAAAGGCGCGCCG	C	.	.	RS=376342519;MY_TARGET=1,1,.?chr1?10500?10700??
chr1	10642	rs558604819	G	A	.	.	RS=558604819;MY_TARGET=1,1,.?chr1?10500?10700??
```

Similarly, entries that are not on target can be extracted by doing the following command
```
cat sample.target.vcf | grep MY_TARGET=0 | less  
```




